# Session 20-02-2026 â€” RÃ©sumÃ© des features

## Ce qui a Ã©tÃ© fait

### 1. Splash Screen

**Fichiers :** `src/components/SplashScreen.jsx` + `SplashScreen.css`  
**ModifiÃ© :** `src/App.jsx`

Au lancement de l'app, un Ã©cran plein-Ã©cran se superpose Ã  tout le contenu (`position: fixed`, `z-index: 9999`). Il affiche le logo C6 Radio avec une animation d'entrÃ©e et un spinner rouge. AprÃ¨s **2,5 secondes**, il disparaÃ®t en fondu.

**Fonctionnement React :**
```
App.jsx : showSplash = true
  â†’ <SplashScreen> s'affiche par-dessus tout
  â†’ aprÃ¨s 2500ms â†’ animation CSS de sortie (0.5s)
  â†’ onAnimationEnd() â†’ onComplete() â†’ showSplash = false
  â†’ <SplashScreen> retirÃ© du DOM
```

**Pour ajouter un jingle audio :**
1. DÃ©poser le fichier dans `/public/jingle.mp3`
2. Dans `SplashScreen.jsx`, dÃ©commenter les 3 lignes dans le `useEffect` :
```js
const audio = new Audio('/jingle.mp3');
audio.volume = 0.7;
audio.play().catch(() => {});
```

**Pour changer la durÃ©e :** modifier `duration={2500}` dans `App.jsx`.

---

### 2. Page d'accueil refaite

**Fichiers :** `src/pages/Home.jsx` + `Home.css`  
**ModifiÃ© :** `src/services/wordpress.js` (ajout param `sticky`)

La page d'accueil est maintenant **dynamique** : elle charge des articles depuis WordPress.

**Structure de la page :**

| Section | Contenu |
|---|---|
| **"Ã€ la une"** | 1 grand article (image en fond, titre, extrait, date) |
| **"DerniÃ¨res actualitÃ©s"** | Grille de 6 articles (composant NewsCard rÃ©utilisÃ©) |
| **Bouton** | "Toutes les actualitÃ©s" â†’ `/news` |

**StratÃ©gie de chargement (2 requÃªtes en parallÃ¨le) :**
```
Promise.all([
  fetchPosts({ sticky: true, per_page: 1 }),   // article Ã©pinglÃ© dans WP ?
  fetchPosts({ per_page: 7 })                   // 7 articles rÃ©cents
])

Si article Ã©pinglÃ© â†’ "Ã€ la une" = article Ã©pinglÃ©, grille = 6 rÃ©cents
Sinon           â†’ "Ã€ la une" = 1er rÃ©cent,         grille = 6 suivants
```

**Comment Ã©pingler un article dans WordPress :**  
Admin WP â†’ Modifier un article â†’ Panneau "Statut" â†’ cocher **"Mis en avant"** (Sticky)

**CatÃ©gories exclues de l'accueil :**  
Les catÃ©gories banniÃ¨res (ID 32) et municipales/contextuelles (ajoutÃ©es manuellement dans `Home.jsx`) sont exclues pour ne montrer que les actualitÃ©s gÃ©nÃ©rales.

---

### 3. Pages Partenaires / Prestations / Contact / Appli

**Fichiers crÃ©Ã©s :** `src/pages/DesktopOnlyPage.jsx` + `DesktopOnlyPage.css`  
**ModifiÃ© :** `src/router.jsx`, `src/pages/DynamicPage.jsx`

| Page | URL | Mobile | Desktop |
|---|---|---|---|
| Nos Partenaires | `/partenaires` | âœ… Accessible | âœ… Accessible |
| Nos Prestations | `/prestations` | âœ… Accessible | âœ… Accessible |
| Contact | `/contact` | âœ… Accessible | âœ… Accessible |
| Appli | `/appli` | ğŸš« Message blocage | âœ… Accessible |

**Contenu depuis WordPress :**  
Ces pages utilisent `DynamicPage` qui lit l'URL et charge automatiquement la page WordPress correspondante. Il faut crÃ©er dans WordPress des pages avec exactement ces slugs : `partenaires`, `prestations`, `contact`, `appli`.

**Fix slug `undefined` (DynamicPage.jsx) :**  
Quand une route est dÃ©clarÃ©e statiquement (`/contact`), `useParams()` retourne `{}` donc `slug = undefined`. Correction : on utilise `useLocation()` comme fallback pour lire le pathname directement.
```js
const { slug: slugParam } = useParams();
const { pathname } = useLocation();
const slug = slugParam || pathname.replace(/^\//, '').split('/')[0];
```

---

### 4. Refonte du menu de navigation

**ModifiÃ© :** `src/components/Header.jsx` + `Header.css`

**Avant :** Tous les liens s'affichaient inline sur desktop, hamburger uniquement sur mobile.  
**AprÃ¨s :** 3 liens primaires toujours visibles + bouton hamburger **toujours prÃ©sent**.

**Structure du header :**
```
[C6Radio]  [Accueil]  [ActualitÃ©s]  [ğŸ—³ï¸ Ã‰lections]  [â˜°]
```

**Panneau hamburger (slide depuis la droite) :**
```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Accueil
  ActualitÃ©s
  ğŸ—³ï¸ Ã‰lections
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Nos Partenaires
  Nos Prestations
  Contact
  ğŸ“± Appli  (masquÃ© sur mobile)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [pages WP dynamiques]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

- Le panneau se ferme en cliquant sur un lien **ou** sur l'overlay sombre derriÃ¨re
- Sur **mobile** : les 3 liens inline disparaissent, le hamburger contient tout
- `.nav-item--desktop-only` masque le lien "Appli" sur mobile (< 768px)

---

## Fichiers modifiÃ©s / crÃ©Ã©s ce jour

| Fichier | Action |
|---|---|
| `src/components/SplashScreen.jsx` | âœ¨ CrÃ©Ã© |
| `src/components/SplashScreen.css` | âœ¨ CrÃ©Ã© |
| `src/pages/DesktopOnlyPage.jsx` | âœ¨ CrÃ©Ã© |
| `src/pages/DesktopOnlyPage.css` | âœ¨ CrÃ©Ã© |
| `src/pages/Home.jsx` | ğŸ”„ RÃ©Ã©crit |
| `src/pages/Home.css` | ğŸ”„ RÃ©Ã©crit |
| `src/App.jsx` | âœï¸ Ajout SplashScreen |
| `src/router.jsx` | âœï¸ 4 nouvelles routes |
| `src/components/Header.jsx` | âœï¸ Refonte navigation |
| `src/components/Header.css` | âœï¸ Refonte navigation |
| `src/services/wordpress.js` | âœï¸ Param `sticky` dans `fetchPosts` |
| `src/pages/DynamicPage.jsx` | âœï¸ Fix slug `undefined` via `useLocation` |

---

## Prochaines Ã©tapes (NEXT-FEATURES.md)

- `[x]` Ã‰vÃ©nements par Communes (mÃªme principe que Ã‰lections)
- `[x]` Page Patrimoine/DÃ©couverte par Communes
- `[x]` Repenser systÃ¨me actus/articles (gÃ©nÃ©ral, ciblÃ© par commune, accueil)
- `[x]` Service WordPress : exclure catÃ©gories contextuelles dans `fetchPosts` (par slug prÃ©fixe ?)

---

## Session suite â€” Ã‰vÃ©nements, Patrimoine & Refactorisation exclusion catÃ©gories

### 5. Sections contextuelles : Ã‰vÃ©nements + Patrimoine

**ModifiÃ© :** `src/router.jsx`, `src/components/Header.jsx`, `src/pages/ContextualHome.jsx`

**Nouvelles routes :**
| URL | Composant |
|-----|-----------|
| `/evenements` | `<ContextualHome context="evenements" />` |
| `/evenements/:subcategory` | `<ContextualPage context="evenements" />` |
| `/patrimoine` | `<ContextualHome context="patrimoine" />` |
| `/patrimoine/:subcategory` | `<ContextualPage context="patrimoine" />` |

> âš ï¸ Les routes `/evenements` existaient dÃ©jÃ , elles n'avaient juste pas de liens dans la navigation.

**Navigation ajoutÃ©e dans Header :**
```
[C6Radio]  [Accueil]  [ActualitÃ©s]  [ğŸ—³ï¸ Ã‰lections]  [ğŸ‰ Ã‰vÃ©nements]  [ğŸ›ï¸ Patrimoine]  [â˜°]
```
MÃªme chose dans le panneau hamburger.

**ContextualHome :** label, icÃ´ne (`ğŸ›ï¸`) et description ajoutÃ©s pour le contexte `patrimoine`.

---

### 6. Refactorisation â€” Exclusion dynamique des catÃ©gories contextuelles

**ProblÃ¨me avant :**
- `Home.jsx` avait des IDs de catÃ©gories hardcodÃ©s Ã  exclure : `[32, 37, 36, 35, 33, 39, 34, 38]`
- `News.jsx` avait la liste `CONTEXTUAL_PREFIXES` locale, dupliquÃ©e
- L'ajout d'un nouveau contexte (`patrimoine`) nÃ©cessitait de modifier plusieurs fichiers

**Solution :**

**`src/config/constants.js`** â€” Nouvelle constante centralisÃ©e :
```js
export const CONTEXTUAL_CATEGORY_PREFIXES = [
  'election-', 'elections-',
  'event-', 'evenement-', 'evenements-',
  'quartier-', 'quartiers-',
  'sport-', 'sports-',
  'patrimoine-',
];
```

**`src/services/wordpress.js`** â€” Nouvelle fonction `fetchContextualCategoryIds()` :
- Charge toutes les catÃ©gories WP
- Filtre par banniÃ¨res (ID 32) + prÃ©fixes contextuels
- Retourne un tableau d'IDs Ã  exclure
- UtilisÃ©e Ã  la place des IDs hardcodÃ©s

**`src/pages/Home.jsx`** â€” Utilise `fetchContextualCategoryIds()` :
- Plus d'IDs hardcodÃ©s
- Exclusions automatiquement Ã  jour si nouvelles catÃ©gories ajoutÃ©es dans WP

**`src/pages/News.jsx`** â€” Utilise `fetchContextualCategoryIds()` :
- MÃªme logique, chargement en `Promise.all` avec `fetchCategories()`
- Code rÃ©duit et centralisÃ©

**Ã€ retenir pour l'Ã©diteur :**
- Ajouter un nouveau contexte cÃ´tÃ© code = 1 ligne dans `CONTEXTUAL_CATEGORY_PREFIXES`
- Les catÃ©gories WP avec les bons prÃ©fixes sont **automatiquement** exclues de NEWS et de l'Accueil

---

### Fichiers modifiÃ©s (session suite)

| Fichier | Action |
|---------|--------|
| `src/config/constants.js` | âœï¸ Ajout `CONTEXTUAL_CATEGORY_PREFIXES` |
| `src/services/wordpress.js` | âœï¸ Ajout `fetchContextualCategoryIds()` + import constante |
| `src/router.jsx` | âœï¸ Routes `/patrimoine` et `/patrimoine/:subcategory` |
| `src/components/Header.jsx` | âœï¸ Liens nav Ã‰vÃ©nements + Patrimoine |
| `src/pages/ContextualHome.jsx` | âœï¸ Support contexte `patrimoine` |
| `src/pages/News.jsx` | âœï¸ Utilise `fetchContextualCategoryIds()` |
| `src/pages/Home.jsx` | âœï¸ Exclusion dynamique via `fetchContextualCategoryIds()` |
| `docs/CONTEXTUAL-SECTIONS.md` | âœï¸ Section Patrimoine ajoutÃ©e |
| `docs/ACF-CONTEXTUAL-SECTIONS.md` | âœï¸ Choix `patrimoine` dans ACF |

